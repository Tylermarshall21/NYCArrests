# Data transformation

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyr)
library(dplyr)
library(lubridate)
```

## Arrest Data

### Data Import - 2021 Data

We begin by importing our data source as-is. This will give us a starting point for our data adjustment and cleaning. We save this data as 'nyc_arrests'.

```{r}
nyc_arrests <- read.table("https://data.cityofnewyork.us/api/views/uip8-fykc/rows.csv?accessType=DOWNLOAD",
                          header=TRUE,
                          sep=",",
                          quote='"'
                          )
```

For easier use of the dates associated with the arrests, we will convert these into R-compatible dates. We will also remove several columns not necessary for the analysis.

```{r}
nyc_arrests$ARREST_DATE <- as_date(nyc_arrests$ARREST_DATE, format="%m/%d/%Y")
nyc_arrests <- nyc_arrests %>% select(-c(New.Georeferenced.Column, X_COORD_CD, Y_COORD_CD))
```

### Data Import - 2006-2021 Data

We now repeat this transformation on our older data. We save this data as 'nyc_arrests_old'. One issue with this dataset is its size. Weighing in at over one Gigabyte, this dataset in its unmodified form takes a very long time to download and modify. As a result, we have decided to utilize a reduced version of this dataset that only includes data starting in 2011. The transformations used to create this historical dataset are seen below:

```{r, eval=FALSE}
nyc_arrests <- read.table("D:/Documents/R Projects/Final Project Proposal/NYPD_Arrests_Data__Historic_.csv",
                           header=TRUE,
                           sep=",",
                           quote='"'
)

nyc_arrests <- nyc_arrests %>% select(-c(Lon_Lat, X_COORD_CD, Y_COORD_CD))

nyc_arrests$ARREST_DATE <- as_date(nyc_arrests$ARREST_DATE, format="%m/%d/%Y")

nyc_arrests <- filter(nyc_arrests, ARREST_DATE > "2010-12-31")

write.csv(nyc_arrests, file="nyc_arrests_post2010.csv")
```

We then run a matching set of data transformations.

```{r}
nyc_arrests_old <- read.table("nyc_arrests_post2010.csv",
                          header=TRUE,
                          sep=",",
                          quote='"'
                          )
nyc_arrests_old <- nyc_arrests_old %>% select(-c(X))
nyc_arrests_old$ARREST_DATE <- as_date(nyc_arrests_old$ARREST_DATE, format="%Y-%m-%d")
```

### Combining Old and New

For a lot of our analysis we will want a combined dataset, so we can append the historical data to the 2021 data like so:

```{r}
nyc_arrests_combined <- bind_rows(nyc_arrests, nyc_arrests_old)
```

This is the main dataset we will be using throughout our analysis, but for certain visualizations we will want our data by category of arrest. The transformation to get the data in that form is below.

### Aggregating by Category

For many of our analyses, it is sensible to aggregate crime by its rough category, like so:

```{r}
nyc_arrests_by_category_year_boro <- (
  nyc_arrests_combined %>%
    drop_na(OFNS_DESC) %>%
    filter(OFNS_DESC != "", ARREST_BORO != "") %>%
    mutate(ARREST_YEAR = year(ARREST_DATE)) %>%
    group_by(ARREST_YEAR, OFNS_DESC, ARREST_BORO) %>%
    summarize(COUNT_OF_ARRESTS = n())
)
```

## Crime Data

The other dataset that we will be using in our analysis is a dataset looking at crime in New York. This dataset gives aggregated crime numbers for each New York county, and this data is from 2010-2020. We will be using this to compare to arrest levels in our analysis, so we did the following transformation below to get data by borough.

```{r}
# Crime Data Import
nyc_crime <- read.table("https://data.ny.gov/api/views/ca8h-8gjq/rows.csv?accessType=DOWNLOAD&sorting=true",
                        header=TRUE,
                        sep=",",
                        quote='"'
                        )

nyc_crime <- (
  filter(nyc_crime, Region == "New York City", Year > 2010) %>%
    select(c(County, Year, Murder, Rape, Aggravated.Assault, Motor.Vehicle.Theft)) %>%
    mutate(Category = "Crime Reports")
)
```

